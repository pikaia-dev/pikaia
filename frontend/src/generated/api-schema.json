{"openapi": "3.1.0", "info": {"title": "B2B SaaS Starter API", "version": "1.0.0", "description": "B2B SaaS API with Stytch authentication and Stripe billing.", "contact": {"name": "API Support"}}, "paths": {"/api/v1/health": {"get": {"operationId": "healthCheck", "summary": "Health check", "parameters": [], "responses": {"200": {"description": "OK"}}, "description": "Health check endpoint for load balancer.", "tags": ["health"]}}, "/api/v1/auth/magic-link/send": {"post": {"operationId": "sendMagicLink", "summary": "Send magic link email", "parameters": [], "responses": {"200": {"description": "OK", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/MessageResponse"}}}}, "400": {"description": "Bad Request", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}}, "description": "Send a magic link email for discovery authentication.\n\nUses discovery flow - user authenticates first, then picks/creates org.", "tags": ["auth"], "requestBody": {"content": {"application/json": {"schema": {"$ref": "#/components/schemas/MagicLinkSendRequest"}}}, "required": true}}}, "/api/v1/auth/magic-link/authenticate": {"post": {"operationId": "authenticateMagicLink", "summary": "Authenticate magic link token", "parameters": [], "responses": {"200": {"description": "OK", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/MagicLinkAuthenticateResponse"}}}}, "400": {"description": "Bad Request", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}}, "description": "Authenticate a magic link token.\n\nReturns an intermediate session token (IST) and list of\norganizations the user can join or create.", "tags": ["auth"], "requestBody": {"content": {"application/json": {"schema": {"$ref": "#/components/schemas/MagicLinkAuthenticateRequest"}}}, "required": true}}}, "/api/v1/auth/discovery/create-org": {"post": {"operationId": "createOrganization", "summary": "Create new organization", "parameters": [], "responses": {"200": {"description": "OK", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/SessionResponse"}}}}, "400": {"description": "Bad Request", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}, "409": {"description": "Conflict", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}}, "description": "Create a new organization from discovery flow.\n\nExchanges the IST for a session and creates the org.", "tags": ["auth"], "requestBody": {"content": {"application/json": {"schema": {"$ref": "#/components/schemas/DiscoveryCreateOrgRequest"}}}, "required": true}}}, "/api/v1/auth/discovery/exchange": {"post": {"operationId": "exchangeSession", "summary": "Exchange IST for session", "parameters": [], "responses": {"200": {"description": "OK", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/SessionResponse"}}}}, "400": {"description": "Bad Request", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}}, "description": "Exchange IST for session by joining an existing organization.", "tags": ["auth"], "requestBody": {"content": {"application/json": {"schema": {"$ref": "#/components/schemas/DiscoveryExchangeRequest"}}}, "required": true}}}, "/api/v1/auth/logout": {"post": {"operationId": "logout", "summary": "Revoke current session", "parameters": [], "responses": {"200": {"description": "OK", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/MessageResponse"}}}}, "401": {"description": "Unauthorized", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}}, "description": "Revoke the current session.\n\nExpects session JWT in Authorization header (Bearer <session_jwt>),\nconsistent with other authenticated endpoints.", "tags": ["auth"], "security": [{"BearerAuth": []}]}}, "/api/v1/auth/me": {"get": {"operationId": "getCurrentUser", "summary": "Get current user info", "parameters": [], "responses": {"200": {"description": "OK", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/MeResponse"}}}}, "401": {"description": "Unauthorized", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}}, "description": "Get current authenticated user, member, and organization info.\n\nRequires valid session JWT in Authorization header.", "tags": ["auth"], "security": [{"BearerAuth": []}]}}, "/api/v1/auth/me/profile": {"patch": {"operationId": "updateProfile", "summary": "Update user profile", "parameters": [], "responses": {"200": {"description": "OK", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/UserInfo"}}}}, "401": {"description": "Unauthorized", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}}, "description": "Update current user's profile (name only).\n\nUpdates local database and syncs to Stytch.\nPhone number changes require OTP verification via /phone/verify-otp.", "tags": ["auth"], "requestBody": {"content": {"application/json": {"schema": {"$ref": "#/components/schemas/UpdateProfileRequest"}}}, "required": true}, "security": [{"BearerAuth": []}]}}, "/api/v1/auth/phone/send-otp": {"post": {"operationId": "sendPhoneOtp", "summary": "Send OTP to phone for verification", "parameters": [], "responses": {"200": {"description": "OK", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/PhoneOtpResponse"}}}}, "400": {"description": "Bad Request", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}, "401": {"description": "Unauthorized", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}}, "description": "Send a one-time password (OTP) to the specified phone number.\n\nThe OTP is used to verify phone ownership before updating the user's profile.\nUses Stytch's SMS OTP service.", "tags": ["auth"], "requestBody": {"content": {"application/json": {"schema": {"$ref": "#/components/schemas/SendPhoneOtpRequest"}}}, "required": true}, "security": [{"BearerAuth": []}]}}, "/api/v1/auth/phone/verify-otp": {"post": {"operationId": "verifyPhoneOtp", "summary": "Verify phone OTP and update profile", "parameters": [], "responses": {"200": {"description": "OK", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/UserInfo"}}}}, "400": {"description": "Bad Request", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}, "401": {"description": "Unauthorized", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}}, "description": "Verify the OTP sent to the phone number.\n\nOn success, updates the user's phone number in both local database and Stytch.", "tags": ["auth"], "requestBody": {"content": {"application/json": {"schema": {"$ref": "#/components/schemas/VerifyPhoneOtpRequest"}}}, "required": true}, "security": [{"BearerAuth": []}]}}, "/api/v1/auth/email/start-update": {"post": {"operationId": "startEmailUpdate", "summary": "Start email address update flow", "parameters": [], "responses": {"200": {"description": "OK", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/EmailUpdateResponse"}}}}, "400": {"description": "Bad Request", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}, "401": {"description": "Unauthorized", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}}, "description": "Initiate email address change.\n\nSends a verification to the new email address. User must verify the new\nemail to complete the change. The update is finalized via Stytch.", "tags": ["auth"], "requestBody": {"content": {"application/json": {"schema": {"$ref": "#/components/schemas/StartEmailUpdateRequest"}}}, "required": true}, "security": [{"BearerAuth": []}]}}, "/api/v1/auth/organization": {"get": {"operationId": "getOrganization", "summary": "Get current organization details", "parameters": [], "responses": {"200": {"description": "OK", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/OrganizationDetailResponse"}}}}, "401": {"description": "Unauthorized", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}}, "description": "Get current organization details including billing info.\n\nAll authenticated members can view.", "tags": ["auth"], "security": [{"BearerAuth": []}]}, "patch": {"operationId": "updateOrganization", "summary": "Update organization settings", "parameters": [], "responses": {"200": {"description": "OK", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/OrganizationDetailResponse"}}}}, "401": {"description": "Unauthorized", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}, "403": {"description": "Forbidden", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}}, "description": "Update organization settings (name).\n\nAdmin only. Updates local database and syncs to Stytch.", "tags": ["auth"], "requestBody": {"content": {"application/json": {"schema": {"$ref": "#/components/schemas/UpdateOrganizationRequest"}}}, "required": true}, "security": [{"BearerAuth": []}]}}, "/api/v1/auth/organization/billing": {"patch": {"operationId": "updateBilling", "summary": "Update organization billing info", "parameters": [], "responses": {"200": {"description": "OK", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/OrganizationDetailResponse"}}}}, "401": {"description": "Unauthorized", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}, "403": {"description": "Forbidden", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}}, "description": "Update organization billing info (address, VAT, etc.).\n\nAdmin only. This is our system's data - synced out to Stripe.", "tags": ["auth"], "requestBody": {"content": {"application/json": {"schema": {"$ref": "#/components/schemas/UpdateBillingRequest"}}}, "required": true}, "security": [{"BearerAuth": []}]}}, "/api/v1/auth/organization/members": {"get": {"operationId": "listMembers", "summary": "List organization members", "parameters": [], "responses": {"200": {"description": "OK", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/MemberListResponse"}}}}, "401": {"description": "Unauthorized", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}, "403": {"description": "Forbidden", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}}, "description": "List all active members of the current organization.\n\nAdmin only.", "tags": ["auth"], "security": [{"BearerAuth": []}]}, "post": {"operationId": "inviteMember", "summary": "Invite a new member", "parameters": [], "responses": {"200": {"description": "OK", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/InviteMemberResponse"}}}}, "400": {"description": "Bad Request", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}, "401": {"description": "Unauthorized", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}, "403": {"description": "Forbidden", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}}, "description": "Invite a new member to the organization.\n\nAdmin only. Stytch sends the invite email with Magic Link.", "tags": ["auth"], "requestBody": {"content": {"application/json": {"schema": {"$ref": "#/components/schemas/InviteMemberRequest"}}}, "required": true}, "security": [{"BearerAuth": []}]}}, "/api/v1/auth/organization/members/{member_id}": {"patch": {"operationId": "updateMemberRole", "summary": "Update member role", "parameters": [{"in": "path", "name": "member_id", "schema": {"title": "Member Id", "type": "integer"}, "required": true}], "responses": {"200": {"description": "OK", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/MessageResponse"}}}}, "400": {"description": "Bad Request", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}, "401": {"description": "Unauthorized", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}, "403": {"description": "Forbidden", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}, "404": {"description": "Not Found", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}}, "description": "Update a member's role (admin or member).\n\nAdmin only. Cannot change your own role.", "tags": ["auth"], "requestBody": {"content": {"application/json": {"schema": {"$ref": "#/components/schemas/UpdateMemberRoleRequest"}}}, "required": true}, "security": [{"BearerAuth": []}]}, "delete": {"operationId": "deleteMember", "summary": "Remove member from organization", "parameters": [{"in": "path", "name": "member_id", "schema": {"title": "Member Id", "type": "integer"}, "required": true}], "responses": {"200": {"description": "OK", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/MessageResponse"}}}}, "400": {"description": "Bad Request", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}, "401": {"description": "Unauthorized", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}, "403": {"description": "Forbidden", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}, "404": {"description": "Not Found", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}}, "description": "Remove a member from the organization.\n\nAdmin only. Cannot remove yourself. Soft deletes locally\nand removes from Stytch.", "tags": ["auth"], "security": [{"BearerAuth": []}]}}, "/api/v1/auth/directory/search": {"get": {"operationId": "searchDirectory", "summary": "Search Google Workspace directory for users", "parameters": [{"in": "query", "name": "q", "schema": {"default": "", "title": "Q", "type": "string"}, "required": false}], "responses": {"200": {"description": "OK", "content": {"application/json": {"schema": {"items": {"$ref": "#/components/schemas/DirectoryUserSchema"}, "title": "Response", "type": "array"}}}}, "401": {"description": "Unauthorized", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}}, "description": "Search Google Workspace directory for coworkers.\n\nReturns matching users from the authenticated user's Google Workspace domain.\nOnly works if the user has signed in with Google OAuth and granted\nthe Directory API scope. Returns empty list if not available.", "tags": ["auth"], "security": [{"BearerAuth": []}]}}, "/api/v1/auth/directory/avatar": {"get": {"operationId": "getDirectoryAvatar", "summary": "Proxy Google Workspace avatar image", "parameters": [{"in": "query", "name": "url", "schema": {"default": "", "title": "Url", "type": "string"}, "required": false}], "responses": {"200": {"description": "OK", "content": {"application/json": {"schema": {"format": "binary", "title": "Response", "type": "string"}}}}, "401": {"description": "Unauthorized", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}, "404": {"description": "Not Found", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}}, "description": "Proxy a Google Workspace avatar image.\n\nGoogle Directory API avatar URLs require OAuth authentication.\nThis endpoint fetches the image server-side and returns it.", "tags": ["auth"], "security": [{"BearerAuth": []}]}}, "/api/v1/billing/checkout": {"post": {"operationId": "createCheckoutSession", "summary": "Create Stripe Checkout session", "parameters": [], "responses": {"200": {"description": "OK", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/CheckoutSessionResponse"}}}}, "401": {"description": "Unauthorized", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}, "403": {"description": "Forbidden", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}}, "description": "Create a Stripe Checkout session for subscribing.\n\nAdmin only. Returns URL to redirect user to Stripe Checkout.", "tags": ["billing"], "requestBody": {"content": {"application/json": {"schema": {"$ref": "#/components/schemas/CheckoutSessionRequest"}}}, "required": true}, "security": [{"BearerAuth": []}]}}, "/api/v1/billing/portal": {"post": {"operationId": "createPortalSession", "summary": "Create Stripe Customer Portal session", "parameters": [], "responses": {"200": {"description": "OK", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/PortalSessionResponse"}}}}, "401": {"description": "Unauthorized", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}, "403": {"description": "Forbidden", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}}, "description": "Create a Stripe Customer Portal session.\n\nAdmin only. Returns URL to redirect user to manage their subscription.", "tags": ["billing"], "requestBody": {"content": {"application/json": {"schema": {"$ref": "#/components/schemas/PortalSessionRequest"}}}, "required": true}, "security": [{"BearerAuth": []}]}}, "/api/v1/billing/subscription": {"get": {"operationId": "getSubscription", "summary": "Get current subscription status", "parameters": [], "responses": {"200": {"description": "OK", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/SubscriptionResponse"}}}}, "401": {"description": "Unauthorized", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}}, "description": "Get current subscription status.\n\nReturns subscription details or 'none' status if not subscribed.", "tags": ["billing"], "security": [{"BearerAuth": []}]}}, "/api/v1/billing/subscription-intent": {"post": {"operationId": "createSubscriptionIntent", "summary": "Create subscription intent for Elements payment", "parameters": [], "responses": {"200": {"description": "OK", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/SubscriptionIntentResponse"}}}}, "400": {"description": "Bad Request", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}, "401": {"description": "Unauthorized", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}, "403": {"description": "Forbidden", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}}, "description": "Create a subscription with an incomplete payment intent.\n\nAdmin only. Returns client_secret for PaymentElement.\nUse this for embedded Stripe Elements payment flow.", "tags": ["billing"], "requestBody": {"content": {"application/json": {"schema": {"$ref": "#/components/schemas/SubscriptionIntentRequest"}}}, "required": true}, "security": [{"BearerAuth": []}]}}, "/api/v1/billing/confirm-subscription": {"post": {"operationId": "confirmSubscription", "summary": "Confirm subscription after payment", "parameters": [], "responses": {"200": {"description": "OK", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ConfirmSubscriptionResponse"}}}}, "400": {"description": "Bad Request", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}, "401": {"description": "Unauthorized", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}, "403": {"description": "Forbidden", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}}, "description": "Sync subscription status from Stripe after payment.\n\nCall this after confirmPayment succeeds to update local database.\nUseful for development without Stripe CLI webhooks.", "tags": ["billing"], "requestBody": {"content": {"application/json": {"schema": {"$ref": "#/components/schemas/ConfirmSubscriptionRequest"}}}, "required": true}, "security": [{"BearerAuth": []}]}}, "/api/v1/billing/invoices": {"get": {"operationId": "listInvoices", "summary": "List organization invoices", "parameters": [{"in": "query", "name": "limit", "schema": {"default": 12, "title": "Limit", "type": "integer"}, "required": false}, {"in": "query", "name": "starting_after", "schema": {"anyOf": [{"type": "string"}, {"type": "null"}], "title": "Starting After"}, "required": false}], "responses": {"200": {"description": "OK", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/InvoiceListResponse"}}}}, "401": {"description": "Unauthorized", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}, "403": {"description": "Forbidden", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}}, "description": "List invoices from Stripe for the current organization.\n\nAdmin only. Returns invoices sorted by date (newest first).\nUse starting_after with an invoice ID for pagination.", "tags": ["billing"], "security": [{"BearerAuth": []}]}}, "/api/v1/media/upload-request": {"post": {"operationId": "requestImageUpload", "summary": "Request an image upload URL", "parameters": [], "responses": {"200": {"description": "OK", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/UploadResponseSchema"}}}}, "400": {"description": "Bad Request", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}, "401": {"description": "Unauthorized", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}}, "description": "Request a presigned URL for uploading an image.\n\nReturns upload URL and instructions. The client should:\n1. Upload the file to the returned URL using the specified method\n2. Call /confirm endpoint after successful upload", "tags": ["media"], "requestBody": {"content": {"application/json": {"schema": {"$ref": "#/components/schemas/UploadRequestSchema"}}}, "required": true}, "security": [{"BearerAuth": []}]}}, "/api/v1/media/confirm": {"post": {"operationId": "confirmImageUpload", "summary": "Confirm an image upload", "parameters": [], "responses": {"200": {"description": "OK", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ImageResponseSchema"}}}}, "400": {"description": "Bad Request", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}, "401": {"description": "Unauthorized", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}, "404": {"description": "Not Found", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}}, "description": "Confirm that an image was successfully uploaded.\n\nVerifies the file exists in storage and saves metadata to the database.", "tags": ["media"], "requestBody": {"content": {"application/json": {"schema": {"$ref": "#/components/schemas/ConfirmUploadSchema"}}}, "required": true}, "security": [{"BearerAuth": []}]}}, "/api/v1/media/direct-upload": {"post": {"operationId": "directUpload", "summary": "Direct upload for local development", "parameters": [], "responses": {"200": {"description": "OK", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/DirectUploadResponseSchema"}}}}, "400": {"description": "Bad Request", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}, "401": {"description": "Unauthorized", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}}, "description": "Direct file upload endpoint for local development.\n\nIn production, files are uploaded directly to S3 using presigned URLs.\nThis endpoint is only used in local development.", "tags": ["media"], "requestBody": {"content": {"multipart/form-data": {"schema": {"properties": {"file": {"format": "binary", "title": "File", "type": "string"}, "key": {"default": "", "title": "Key", "type": "string"}, "content_type": {"default": "", "title": "Content Type", "type": "string"}}, "required": ["file"], "title": "MultiPartBodyParams", "type": "object"}}}, "required": true}, "security": [{"BearerAuth": []}]}}, "/api/v1/media/{image_id}": {"delete": {"operationId": "deleteImage", "summary": "Delete an uploaded image", "parameters": [{"in": "path", "name": "image_id", "schema": {"title": "Image Id", "type": "string"}, "required": true}], "responses": {"200": {"description": "OK", "content": {"application/json": {"schema": {"additionalProperties": true, "title": "Response", "type": "object"}}}}, "401": {"description": "Unauthorized", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}, "403": {"description": "Forbidden", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}, "404": {"description": "Not Found", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/ErrorResponse"}}}}}, "description": "Delete an uploaded image.\n\nUsers can only delete their own avatars.\nAdmins can delete organization logos.", "tags": ["media"], "security": [{"BearerAuth": []}]}}}, "components": {"schemas": {"MessageResponse": {"description": "Generic message response.", "example": {"message": "Operation completed successfully."}, "properties": {"message": {"description": "Human-readable status message", "title": "Message", "type": "string"}}, "required": ["message"], "title": "MessageResponse", "type": "object"}, "ErrorResponse": {"description": "Standard error response format.", "example": {"detail": "Invalid or expired token."}, "properties": {"detail": {"description": "Human-readable error message", "title": "Detail", "type": "string"}}, "required": ["detail"], "title": "ErrorResponse", "type": "object"}, "MagicLinkSendRequest": {"description": "Request to send a magic link email.", "properties": {"email": {"description": "User's email address for magic link delivery", "examples": ["user@company.com"], "format": "email", "title": "Email", "type": "string"}}, "required": ["email"], "title": "MagicLinkSendRequest", "type": "object"}, "DiscoveredOrganization": {"description": "An organization the user can join.", "properties": {"organization_id": {"description": "Stytch organization ID", "title": "Organization Id", "type": "string"}, "organization_name": {"description": "Organization display name", "title": "Organization Name", "type": "string"}, "organization_slug": {"description": "URL-safe organization identifier", "title": "Organization Slug", "type": "string"}}, "required": ["organization_id", "organization_name", "organization_slug"], "title": "DiscoveredOrganization", "type": "object"}, "MagicLinkAuthenticateResponse": {"description": "Response after magic link authentication.", "example": {"discovered_organizations": [{"organization_id": "organization-live-abc123", "organization_name": "Acme Corp", "organization_slug": "acme-corp"}], "email": "user@company.com", "intermediate_session_token": "ist_xxx..."}, "properties": {"intermediate_session_token": {"description": "Token to exchange for a full session after org selection", "title": "Intermediate Session Token", "type": "string"}, "email": {"description": "Authenticated user's email address", "title": "Email", "type": "string"}, "discovered_organizations": {"description": "Organizations the user can join or already belongs to", "items": {"$ref": "#/components/schemas/DiscoveredOrganization"}, "title": "Discovered Organizations", "type": "array"}}, "required": ["intermediate_session_token", "email", "discovered_organizations"], "title": "MagicLinkAuthenticateResponse", "type": "object"}, "MagicLinkAuthenticateRequest": {"description": "Request to authenticate a magic link token.", "properties": {"token": {"description": "Magic link token from the email URL query parameter", "examples": ["DOYoip3rvIMMW2A7LRLI4M3EjcxZ..."], "title": "Token", "type": "string"}}, "required": ["token"], "title": "MagicLinkAuthenticateRequest", "type": "object"}, "SessionResponse": {"description": "Response containing session credentials after org selection.", "example": {"member_id": "member-live-abc123", "organization_id": "organization-live-abc123", "session_jwt": "eyJhbGciOiJSUzI1NiI...", "session_token": "stytch_session_xxx..."}, "properties": {"session_token": {"description": "Stytch session token for server-side use", "title": "Session Token", "type": "string"}, "session_jwt": {"description": "JWT for Authorization header (Bearer token)", "title": "Session Jwt", "type": "string"}, "member_id": {"description": "Stytch member ID within the organization", "title": "Member Id", "type": "string"}, "organization_id": {"description": "Stytch organization ID", "title": "Organization Id", "type": "string"}}, "required": ["session_token", "session_jwt", "member_id", "organization_id"], "title": "SessionResponse", "type": "object"}, "DiscoveryCreateOrgRequest": {"description": "Request to create a new org from discovery flow.", "properties": {"intermediate_session_token": {"description": "Intermediate session token from magic link authentication", "examples": ["ist_xxx..."], "title": "Intermediate Session Token", "type": "string"}, "organization_name": {"description": "Display name for the new organization", "examples": ["Acme Corp"], "title": "Organization Name", "type": "string"}, "organization_slug": {"description": "URL-safe identifier for the organization (lowercase, hyphens allowed)", "examples": ["acme-corp"], "title": "Organization Slug", "type": "string"}}, "required": ["intermediate_session_token", "organization_name", "organization_slug"], "title": "DiscoveryCreateOrgRequest", "type": "object"}, "DiscoveryExchangeRequest": {"description": "Request to exchange IST for session (join existing org).", "properties": {"intermediate_session_token": {"description": "Intermediate session token from magic link authentication", "examples": ["ist_xxx..."], "title": "Intermediate Session Token", "type": "string"}, "organization_id": {"description": "Stytch organization ID to join", "examples": ["organization-live-abc123..."], "title": "Organization Id", "type": "string"}}, "required": ["intermediate_session_token", "organization_id"], "title": "DiscoveryExchangeRequest", "type": "object"}, "MeResponse": {"description": "Response for /auth/me endpoint with current session context.", "example": {"member": {"id": 1, "is_admin": true, "role": "admin", "stytch_member_id": "member-live-abc123"}, "organization": {"id": 1, "name": "Acme Corp", "slug": "acme-corp", "stytch_org_id": "organization-live-abc123"}, "user": {"email": "user@company.com", "id": 1, "name": "Jane Doe"}}, "properties": {"user": {"$ref": "#/components/schemas/UserInfo", "description": "Cross-org user identity"}, "member": {"$ref": "#/components/schemas/MemberInfo", "description": "Org-scoped membership details"}, "organization": {"$ref": "#/components/schemas/OrganizationInfo", "description": "Current organization context"}}, "required": ["user", "member", "organization"], "title": "MeResponse", "type": "object"}, "MemberInfo": {"description": "Member info for /auth/me response.", "properties": {"id": {"description": "Local database member ID", "title": "Id", "type": "integer"}, "stytch_member_id": {"description": "Stytch member ID", "title": "Stytch Member Id", "type": "string"}, "role": {"description": "Member's role within the organization (e.g., admin, member)", "title": "Role", "type": "string"}, "is_admin": {"description": "Whether the member has admin privileges", "title": "Is Admin", "type": "boolean"}}, "required": ["id", "stytch_member_id", "role", "is_admin"], "title": "MemberInfo", "type": "object"}, "OrganizationInfo": {"description": "Organization info for /auth/me response.", "properties": {"id": {"description": "Local database organization ID", "title": "Id", "type": "integer"}, "stytch_org_id": {"description": "Stytch organization ID", "title": "Stytch Org Id", "type": "string"}, "name": {"description": "Organization display name", "title": "Name", "type": "string"}, "slug": {"description": "URL-safe organization identifier", "title": "Slug", "type": "string"}, "logo_url": {"default": "", "description": "URL to organization logo image", "title": "Logo Url", "type": "string"}}, "required": ["id", "stytch_org_id", "name", "slug"], "title": "OrganizationInfo", "type": "object"}, "UserInfo": {"description": "Current user info response.", "properties": {"id": {"description": "Local database user ID", "title": "Id", "type": "integer"}, "email": {"description": "User's email address", "title": "Email", "type": "string"}, "name": {"description": "User's display name", "title": "Name", "type": "string"}, "avatar_url": {"default": "", "description": "URL to user's avatar image", "title": "Avatar Url", "type": "string"}, "phone_number": {"default": "", "description": "Phone number in E.164 format", "title": "Phone Number", "type": "string"}}, "required": ["id", "email", "name"], "title": "UserInfo", "type": "object"}, "UpdateProfileRequest": {"description": "Request to update user profile (name only).\n\nPhone number changes require OTP verification via /phone/verify-otp.", "properties": {"name": {"description": "User's display name", "examples": ["Jane Doe"], "maxLength": 255, "minLength": 1, "title": "Name", "type": "string"}}, "required": ["name"], "title": "UpdateProfileRequest", "type": "object"}, "PhoneOtpResponse": {"description": "Response for phone OTP operations.", "properties": {"success": {"description": "Whether the operation succeeded", "title": "Success", "type": "boolean"}, "message": {"description": "Status message", "title": "Message", "type": "string"}}, "required": ["success", "message"], "title": "PhoneOtpResponse", "type": "object"}, "SendPhoneOtpRequest": {"description": "Request to send OTP to a phone number for verification.", "properties": {"phone_number": {"description": "Phone number in E.164 format", "examples": ["+14155551234"], "maxLength": 20, "minLength": 8, "title": "Phone Number", "type": "string"}}, "required": ["phone_number"], "title": "SendPhoneOtpRequest", "type": "object"}, "VerifyPhoneOtpRequest": {"description": "Request to verify a phone OTP.", "properties": {"phone_number": {"description": "Phone number that received the OTP", "title": "Phone Number", "type": "string"}, "otp_code": {"description": "6-digit OTP code", "examples": ["123456"], "maxLength": 6, "minLength": 6, "title": "Otp Code", "type": "string"}}, "required": ["phone_number", "otp_code"], "title": "VerifyPhoneOtpRequest", "type": "object"}, "EmailUpdateResponse": {"description": "Response for email update initiation.", "properties": {"success": {"description": "Whether the update was initiated", "title": "Success", "type": "boolean"}, "message": {"description": "Status message", "title": "Message", "type": "string"}}, "required": ["success", "message"], "title": "EmailUpdateResponse", "type": "object"}, "StartEmailUpdateRequest": {"description": "Request to start email update flow.", "properties": {"new_email": {"description": "New email address to change to", "examples": ["newemail@example.com"], "format": "email", "title": "New Email", "type": "string"}}, "required": ["new_email"], "title": "StartEmailUpdateRequest", "type": "object"}, "BillingAddressSchema": {"description": "Billing address for organization.", "properties": {"line1": {"default": "", "description": "Street address line 1", "maxLength": 255, "title": "Line1", "type": "string"}, "line2": {"default": "", "description": "Street address line 2", "maxLength": 255, "title": "Line2", "type": "string"}, "city": {"default": "", "description": "City", "maxLength": 100, "title": "City", "type": "string"}, "state": {"default": "", "description": "State/Province/Region", "maxLength": 100, "title": "State", "type": "string"}, "postal_code": {"default": "", "description": "Postal/ZIP code", "maxLength": 20, "title": "Postal Code", "type": "string"}, "country": {"default": "", "description": "ISO 3166-1 alpha-2 country code", "examples": ["US", "DE", "PL"], "maxLength": 2, "title": "Country", "type": "string"}}, "title": "BillingAddressSchema", "type": "object"}, "BillingInfoResponse": {"description": "Organization billing info response.", "properties": {"use_billing_email": {"description": "If True, invoices sent to billing_email; otherwise to admin", "title": "Use Billing Email", "type": "boolean"}, "billing_email": {"description": "Email for invoices", "title": "Billing Email", "type": "string"}, "billing_name": {"description": "Legal/company name", "title": "Billing Name", "type": "string"}, "address": {"$ref": "#/components/schemas/BillingAddressSchema", "description": "Billing address"}, "vat_id": {"description": "EU VAT number", "title": "Vat Id", "type": "string"}}, "required": ["use_billing_email", "billing_email", "billing_name", "address", "vat_id"], "title": "BillingInfoResponse", "type": "object"}, "OrganizationDetailResponse": {"description": "Full organization details response.", "properties": {"id": {"description": "Local database ID", "title": "Id", "type": "integer"}, "stytch_org_id": {"description": "Stytch organization ID", "title": "Stytch Org Id", "type": "string"}, "name": {"description": "Organization display name", "title": "Name", "type": "string"}, "slug": {"description": "URL-safe identifier", "title": "Slug", "type": "string"}, "logo_url": {"default": "", "description": "URL to organization logo image", "title": "Logo Url", "type": "string"}, "billing": {"$ref": "#/components/schemas/BillingInfoResponse", "description": "Billing information"}}, "required": ["id", "stytch_org_id", "name", "slug", "billing"], "title": "OrganizationDetailResponse", "type": "object"}, "UpdateOrganizationRequest": {"description": "Request to update organization settings (admin only).", "properties": {"name": {"description": "Organization display name", "examples": ["Acme Corp"], "maxLength": 255, "minLength": 1, "title": "Name", "type": "string"}, "slug": {"anyOf": [{"type": "string"}, {"type": "null"}], "description": "URL-safe identifier for the organization (2-128 chars, lowercase)", "examples": ["acme-corp"], "title": "Slug"}}, "required": ["name"], "title": "UpdateOrganizationRequest", "type": "object"}, "UpdateBillingRequest": {"description": "Request to update organization billing info (admin only).", "properties": {"use_billing_email": {"default": false, "description": "If True, send invoices to billing_email; otherwise send to admin", "title": "Use Billing Email", "type": "boolean"}, "billing_email": {"anyOf": [{"format": "email", "type": "string"}, {"type": "null"}], "description": "Email for invoices (used only if use_billing_email is True)", "examples": ["billing@company.com"], "title": "Billing Email"}, "billing_name": {"default": "", "description": "Legal/company name for invoices", "examples": ["Acme Corporation Inc."], "maxLength": 255, "title": "Billing Name", "type": "string"}, "address": {"anyOf": [{"$ref": "#/components/schemas/BillingAddressSchema"}, {"type": "null"}], "description": "Billing address"}, "vat_id": {"default": "", "description": "EU VAT number", "examples": ["DE123456789"], "maxLength": 50, "title": "Vat Id", "type": "string"}}, "title": "UpdateBillingRequest", "type": "object"}, "MemberListItem": {"description": "Member info for list response.", "properties": {"id": {"description": "Local database member ID", "title": "Id", "type": "integer"}, "stytch_member_id": {"description": "Stytch member ID", "title": "Stytch Member Id", "type": "string"}, "email": {"description": "Member's email address", "title": "Email", "type": "string"}, "name": {"description": "Member's display name", "title": "Name", "type": "string"}, "role": {"description": "Member's role (admin or member)", "title": "Role", "type": "string"}, "is_admin": {"description": "Whether member has admin privileges", "title": "Is Admin", "type": "boolean"}, "status": {"description": "Member status (active, invited)", "title": "Status", "type": "string"}, "created_at": {"description": "When the member joined (ISO format)", "title": "Created At", "type": "string"}}, "required": ["id", "stytch_member_id", "email", "name", "role", "is_admin", "status", "created_at"], "title": "MemberListItem", "type": "object"}, "MemberListResponse": {"description": "Response containing list of organization members.", "properties": {"members": {"description": "List of active organization members", "items": {"$ref": "#/components/schemas/MemberListItem"}, "title": "Members", "type": "array"}}, "required": ["members"], "title": "MemberListResponse", "type": "object"}, "InviteMemberResponse": {"description": "Response after inviting a member.", "properties": {"message": {"description": "Success message", "title": "Message", "type": "string"}, "stytch_member_id": {"description": "Stytch member ID of invited member", "title": "Stytch Member Id", "type": "string"}}, "required": ["message", "stytch_member_id"], "title": "InviteMemberResponse", "type": "object"}, "InviteMemberRequest": {"description": "Request to invite a new member to the organization.", "properties": {"email": {"description": "Email address of the member to invite", "examples": ["newuser@example.com"], "format": "email", "title": "Email", "type": "string"}, "name": {"default": "", "description": "Optional display name for the member", "examples": ["Jane Doe"], "maxLength": 255, "title": "Name", "type": "string"}, "role": {"default": "member", "description": "Role to assign: 'admin' or 'member'", "examples": ["member"], "pattern": "^(admin|member)$", "title": "Role", "type": "string"}}, "required": ["email"], "title": "InviteMemberRequest", "type": "object"}, "UpdateMemberRoleRequest": {"description": "Request to update a member's role.", "properties": {"role": {"description": "New role: 'admin' or 'member'", "examples": ["admin"], "pattern": "^(admin|member)$", "title": "Role", "type": "string"}}, "required": ["role"], "title": "UpdateMemberRoleRequest", "type": "object"}, "DirectoryUserSchema": {"description": "A user from Google Workspace directory search.", "properties": {"email": {"description": "User's email address", "title": "Email", "type": "string"}, "name": {"description": "User's display name", "title": "Name", "type": "string"}, "avatar_url": {"default": "", "description": "URL to user's avatar image", "title": "Avatar Url", "type": "string"}}, "required": ["email", "name"], "title": "DirectoryUserSchema", "type": "object"}, "CheckoutSessionResponse": {"description": "Response with Checkout session URL.", "properties": {"checkout_url": {"title": "Checkout Url", "type": "string"}}, "required": ["checkout_url"], "title": "CheckoutSessionResponse", "type": "object"}, "CheckoutSessionRequest": {"description": "Request to create a Stripe Checkout session.", "properties": {"success_url": {"title": "Success Url", "type": "string"}, "cancel_url": {"title": "Cancel Url", "type": "string"}, "quantity": {"anyOf": [{"type": "integer"}, {"type": "null"}], "title": "Quantity"}}, "required": ["success_url", "cancel_url"], "title": "CheckoutSessionRequest", "type": "object"}, "PortalSessionResponse": {"description": "Response with Customer Portal URL.", "properties": {"portal_url": {"title": "Portal Url", "type": "string"}}, "required": ["portal_url"], "title": "PortalSessionResponse", "type": "object"}, "PortalSessionRequest": {"description": "Request to create a Stripe Customer Portal session.", "properties": {"return_url": {"title": "Return Url", "type": "string"}}, "required": ["return_url"], "title": "PortalSessionRequest", "type": "object"}, "SubscriptionResponse": {"description": "Current subscription status.", "properties": {"status": {"title": "Status", "type": "string"}, "quantity": {"title": "Quantity", "type": "integer"}, "current_period_end": {"anyOf": [{"type": "string"}, {"type": "null"}], "title": "Current Period End"}, "cancel_at_period_end": {"title": "Cancel At Period End", "type": "boolean"}, "stripe_customer_id": {"anyOf": [{"type": "string"}, {"type": "null"}], "title": "Stripe Customer Id"}}, "required": ["status", "quantity", "current_period_end", "cancel_at_period_end", "stripe_customer_id"], "title": "SubscriptionResponse", "type": "object"}, "SubscriptionIntentResponse": {"description": "Response with client secret for Elements payment form.", "properties": {"client_secret": {"title": "Client Secret", "type": "string"}, "subscription_id": {"title": "Subscription Id", "type": "string"}}, "required": ["client_secret", "subscription_id"], "title": "SubscriptionIntentResponse", "type": "object"}, "SubscriptionIntentRequest": {"description": "Request to create a subscription with payment intent.", "properties": {"quantity": {"anyOf": [{"type": "integer"}, {"type": "null"}], "title": "Quantity"}}, "title": "SubscriptionIntentRequest", "type": "object"}, "ConfirmSubscriptionResponse": {"description": "Response after confirming subscription.", "properties": {"is_active": {"title": "Is Active", "type": "boolean"}}, "required": ["is_active"], "title": "ConfirmSubscriptionResponse", "type": "object"}, "ConfirmSubscriptionRequest": {"description": "Request to confirm/sync subscription after payment.", "properties": {"subscription_id": {"title": "Subscription Id", "type": "string"}}, "required": ["subscription_id"], "title": "ConfirmSubscriptionRequest", "type": "object"}, "InvoiceListResponse": {"description": "List of invoices with pagination info.", "properties": {"invoices": {"items": {"$ref": "#/components/schemas/InvoiceResponse"}, "title": "Invoices", "type": "array"}, "has_more": {"title": "Has More", "type": "boolean"}}, "required": ["invoices", "has_more"], "title": "InvoiceListResponse", "type": "object"}, "InvoiceResponse": {"description": "Invoice data from Stripe.", "properties": {"id": {"title": "Id", "type": "string"}, "number": {"anyOf": [{"type": "string"}, {"type": "null"}], "title": "Number"}, "status": {"title": "Status", "type": "string"}, "amount_due": {"title": "Amount Due", "type": "integer"}, "amount_paid": {"title": "Amount Paid", "type": "integer"}, "currency": {"title": "Currency", "type": "string"}, "created": {"title": "Created", "type": "string"}, "hosted_invoice_url": {"anyOf": [{"type": "string"}, {"type": "null"}], "title": "Hosted Invoice Url"}, "invoice_pdf": {"anyOf": [{"type": "string"}, {"type": "null"}], "title": "Invoice Pdf"}, "period_start": {"anyOf": [{"type": "string"}, {"type": "null"}], "title": "Period Start"}, "period_end": {"anyOf": [{"type": "string"}, {"type": "null"}], "title": "Period End"}}, "required": ["id", "number", "status", "amount_due", "amount_paid", "currency", "created", "hosted_invoice_url", "invoice_pdf", "period_start", "period_end"], "title": "InvoiceResponse", "type": "object"}, "UploadResponseSchema": {"description": "Response with upload URL and instructions.", "properties": {"upload_url": {"description": "URL to upload the file to", "title": "Upload Url", "type": "string"}, "method": {"description": "HTTP method to use (PUT or POST)", "title": "Method", "type": "string"}, "key": {"description": "Storage key for the file", "title": "Key", "type": "string"}, "fields": {"additionalProperties": {"type": "string"}, "description": "Additional form fields for POST uploads", "title": "Fields", "type": "object"}}, "required": ["upload_url", "method", "key"], "title": "UploadResponseSchema", "type": "object"}, "UploadRequestSchema": {"description": "Request to initiate an image upload.", "properties": {"filename": {"description": "Original filename with extension", "examples": ["avatar.jpg"], "maxLength": 255, "minLength": 1, "title": "Filename", "type": "string"}, "content_type": {"description": "MIME type of the image", "examples": ["image/jpeg", "image/png", "image/webp"], "title": "Content Type", "type": "string"}, "size_bytes": {"description": "File size in bytes", "examples": [102400], "exclusiveMinimum": 0, "title": "Size Bytes", "type": "integer"}, "image_type": {"description": "Type of image: 'avatar' or 'logo'", "examples": ["avatar"], "pattern": "^(avatar|logo)$", "title": "Image Type", "type": "string"}}, "required": ["filename", "content_type", "size_bytes", "image_type"], "title": "UploadRequestSchema", "type": "object"}, "ImageResponseSchema": {"description": "Response with uploaded image details.", "properties": {"id": {"description": "Image UUID", "title": "Id", "type": "string"}, "url": {"description": "Public URL to access the image", "title": "Url", "type": "string"}, "width": {"anyOf": [{"type": "integer"}, {"type": "null"}], "description": "Image width in pixels", "title": "Width"}, "height": {"anyOf": [{"type": "integer"}, {"type": "null"}], "description": "Image height in pixels", "title": "Height"}}, "required": ["id", "url"], "title": "ImageResponseSchema", "type": "object"}, "ConfirmUploadSchema": {"description": "Request to confirm an upload was completed.", "properties": {"key": {"description": "Storage key from the upload response", "maxLength": 500, "minLength": 1, "title": "Key", "type": "string"}, "image_type": {"description": "Type of image: 'avatar' or 'logo'", "pattern": "^(avatar|logo)$", "title": "Image Type", "type": "string"}}, "required": ["key", "image_type"], "title": "ConfirmUploadSchema", "type": "object"}, "DirectUploadResponseSchema": {"description": "Response after direct local upload.", "properties": {"key": {"description": "Storage key of the uploaded file", "title": "Key", "type": "string"}, "message": {"description": "Success message", "title": "Message", "type": "string"}}, "required": ["key", "message"], "title": "DirectUploadResponseSchema", "type": "object"}}, "securitySchemes": {"BearerAuth": {"type": "http", "scheme": "bearer"}}}, "servers": [], "tags": [{"name": "auth", "description": "Magic link authentication and session management"}, {"name": "billing", "description": "Subscription management and billing"}, {"name": "media", "description": "Image uploads for avatars and logos"}, {"name": "health", "description": "Service health and readiness checks"}]}
